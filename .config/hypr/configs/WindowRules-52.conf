#  ▗▖ ▗▖▗▄▄▄▖▗▖  ▗▖▗▄▄▄  ▗▄▖ ▗▖ ▗▖    ▗▄▄▖ ▗▖ ▗▖▗▖   ▗▄▄▄▖ ▗▄▄▖
#  ▐▌ ▐▌  █  ▐▛▚▖▐▌▐▌  █▐▌ ▐▌▐▌ ▐▌    ▐▌ ▐▌▐▌ ▐▌▐▌   ▐▌   ▐▌   
#  ▐▌ ▐▌  █  ▐▌ ▝▜▌▐▌  █▐▌ ▐▌▐▌ ▐▌    ▐▛▀▚▖▐▌ ▐▌▐▌   ▐▛▀▀▘ ▝▀▚▖
#  ▐▙█▟▌▗▄█▄▖▐▌  ▐▌▐▙▄▄▀▝▚▄▞▘▐▙█▟▌    ▐▌ ▐▌▝▚▄▞▘▐▙▄▄▖▐▙▄▄▖▗▄▄▞▘                                                             

# See https://wiki.hyprland.org/Configuring/Window-Rules/ for more

# ---------------- App-Specific Rules ----------------

## System Utilities
windowrule = float, class:(org.kde.polkit-kde-authentication-agent-1)
windowrule = float, class:(nm-connection-editor|blueman-manager|pavucontrol|corectrl)
windowrule = float, class:(nwg-look|qt5ct|qt6ct|yad)
windowrule = float, class:(gnome-system-monitor|opensnitch)
windowrule = float, class:(xdg-desktop-portal-gtk|org.freedesktop.impl.portal.desktop.kde)
windowrule = float, class:(org.kde.keditfiletype|org.kde.kdeconnect.handler)
windowrule = float, class:(Tk)

## Media & UI Tweaks
windowrule = float, class:(mpv|eog|qalculate-qt|io.github.Qalculate.qalculate-qt|com.rafaelmardojai.Blanket|com.github.neithern.g4music)

## Gaming
windowrule = float, class:(net.lutris.Lutris|ProtonUp-Qt)
windowrule = float, class:([Ss]team)

## File Management
windowrule = float, class:(file-roller), title:(Open File|Save File|Extract — Dolphin|Export Image.*|Choose Application — Dolphin)
windowrule = float, title:(branchdialog)
windowrule = float, class:(file-.*), title:(Export.*)
windowrule = float, class:(script-fu.*)
windowrule = float, class:(org.gnome.eog)

## Text Editors
windowrule = float, class:(mousepad)

## KDE / Garuda Tools
windowrule = float, class:([Gg]aruda.*|octopi|kdeconnect.*|org.kde.kdeconnect.daemon|org.kde.gwenview)
windowrule = float, class:([Yy]akuake)

## Common Dialogs
windowrule = float, class:(file_progress|confirm|dialog|download|notification|error|splash|confirmreset)

## Misc
windowrule = float, class:foot-dropterm
# windowrule = float, class:foot-kew
# windowrule = float, class:syncplay
windowrule = float, class:kew_player
windowrule = size 12% 40%, class:kew_player
windowrule = move 87% 4%, class:kew_player
windowrule = pin, class:kew_player

# ---------------- General Window Rules ----------------

# windowrule = focusonactivate, class:.*
windowrule = focusonactivate, class:brave-browser
windowrule = focusonactivate, class:codium
windowrule = focusonactivate, class:org.kde.dolphin
windowrule = focusonactivate, class:foot
windowrule = focusonactivate, class:^(?!steam$).*

## Octopi
windowrule = size 1400 996, class:(octopi), title:(Octopi)
windowrule = center, class:(octopi.*), title:(Octopi)

## File Operations
windowrule = float, class:(thunar), title:(File Operation Progress|Confirm to replace files|Rename.*)
windowrule = float, class:(file-roller), title:(Extract archive)

## Music & Gaming Utilities
windowrule = float, class:(io.bassi.Amberol|net.davidotek.pupgui2)

## Web Apps
windowrule = float, class:(brave-(chat.openai.com|gemini.google.com|music.youtube.com|app.tvtime.com).*)
windowrule = size 30% 50%, class:(brave-(chat.openai.com|gemini.google.com|music.youtube.com).*)
windowrule = size 15% 50%, class:(brave-(app.tvtime.com).*)
windowrule = move 2% 5%, class:(brave-(chat.openai.com|gemini.google.com|music.youtube.com).*)
windowrule = move 10% 5%, class:(brave-(app.tvtime.com).*)

## Calculator
windowrule = float, class:(qalculate-gtk.*)
windowrule = move 75.5% 60%, class:(qalculate-gtk.*)
windowrule = size 20% 50%, class:(io.github.Qalculate.qalculate-qt)

## Lutris
windowrule = size 67% 72%, class:(net.lutris.Lutris), title:(Lutris)
windowrule = center, class:(net.lutris.Lutris.*), title:(Lutris)
windowrule = float, class:zenity

## Windows Control Panel
windowrule = center, class:(control.exe)
windowrule = size 45% 70%, class:(control.exe)

## Wallpaper Manager
windowrule = float, class:(waypaper)
windowrule = center, class:(waypaper)
windowrule = size 48% 70%, class:(waypaper)

## File Save Dialogs
windowrule = size 1220 850, class:(brave), title:(Save File|Select file)

## Dolphin File Manager
windowrule = float, class:(org.kde.dolphin), title:(Compressing.*|Extracting.*|File Already Exists.*)

## System Monitor
windowrule = float, class:(org.gnome.SystemMonitor), title:(System Monitor)
windowrule = center, class:(org.gnome.SystemMonitor), title:(System Monitor)

## Qt Configuration Tools
windowrule = center, class:(qt5ct|qt6ct)
windowrule = size 789 503, class:(qt5ct|qt6ct)

## Special Rules
windowrule = noblur, class:(gamescope)
windowrule = fullscreen, class:^(gamescope)$
windowrule = center, title:(pavucontrol)

# ---------------- Picture-in-Picture ----------------
windowrule = float, title:(Picture-in-picture)
windowrule = pin, title:(Picture-in-picture)
windowrule = size 30% 40.5%, title:(Picture-in-picture)
windowrule = keepaspectratio, title:(Picture-in-picture)
windowrule = move 69% 5%, title:(Picture-in-picture)
windowrule = nodim, title:(Picture-in-picture)
windowrule = opaque, title:(Picture-in-picture)

# ---------------- Workspace Assignments ----------------
windowrule = workspace 1, class:(Brave-browser)
windowrule = workspace 2 silent, class:(net.lutris.Lutris)
windowrule = workspace 3 silent, class:(steam)
# windowrule = workspace special, class:(octopi)
windowrule = workspace 6, class:(gimp.*)
windowrule = workspace 7, class:(org.wezfurlong.wezterm)

# ---------------- Window Opacity ----------------
windowrule = opacity 0.9 0.6, class:([Rr]ofi|Brave-browser|codium-url-handler)
windowrule = opacity 0.9 0.9, class:([Tt]hunar)
windowrule = opacity 0.9 0.8, class:(org.kde.dolphin)
windowrule = opacity 0.8 0.6, class:(pcmanfm-qt)
windowrule = opacity 0.9 0.8, class:(gedit|VSCodium)
windowrule = opacity 0.9 0.7, class:(kitty|mousepad|foot|foot-dropterm)
windowrule = opacity 0.8 0.7, class:(steam|net.lutris.Lutris)
windowrule = opacity 1.0 1.0, class:(gimp)

# ---------------- Layer Rules ----------------
layerrule = blur, waybar
layerrule = blur, overview
layerrule = blur, fabric
layerrule = blur, quickshell:overview
layerrule = blur, quickshell:palette
layerrule = blur, hyprswitch
layerrule = blur, swaync-control-center
layerrule = blur, swaync-notification-window
layerrule = ignorezero, waybar
layerrule = ignorezero, overview
layerrule = ignorezero, fabric
layerrule = ignorezero, quickshell:overview
layerrule = ignorezero, quickshell:palette
layerrule = ignorezero, swaync-control-center
layerrule = ignorezero, swaync-notification-window
layerrule = ignorealpha 0.5, swaync-control-center
layerrule = ignorealpha, fabric
layerrule = ignorealpha 0.5, quickshell:overview
layerrule = ignorealpha 0.5, quickshell:palette
layerrule = ignorealpha, swaync-notification-window

layerrule = animation fade, selection
layerrule = noanim, selection

# ---------------- Browser Popups ----------------
windowrule = float, class:(brave|librewolf|chromium), title:(Save File|Open File|.*Popup.*)


# ----------------- Experimental ----------------
windowrule = fullscreen,class:^(matrix)$

# Prevent swaync notification & control-center windows from stealing focus
windowrulev2 = nofocus, class:^(swaync-notification-window)$


#---- BIND
#  ▗▖ ▗▖▗▄▄▄▖▗▖  ▗▖▗▄▄▖ ▗▄▄▄▖▗▖  ▗▖▗▄▄▄ ▗▄▄▄▖▗▖  ▗▖ ▗▄▄▖ ▗▄▄▖
#  ▐▌▗▞▘▐▌    ▝▚▞▘ ▐▌ ▐▌  █  ▐▛▚▖▐▌▐▌  █  █  ▐▛▚▖▐▌▐▌   ▐▌   
#  ▐▛▚▖ ▐▛▀▀▘  ▐▌  ▐▛▀▚▖  █  ▐▌ ▝▜▌▐▌  █  █  ▐▌ ▝▜▌▐▌▝▜▌ ▝▀▚▖
#  ▐▌ ▐▌▐▙▄▄▖  ▐▌  ▐▙▄▞▘▗▄█▄▖▐▌  ▐▌▐▙▄▄▀▗▄█▄▖▐▌  ▐▌▝▚▄▞▘▗▄▄▞▘


# ---------------- App-Specific Rules ----------------

$mainMod = SUPER
$files_main = dolphin
$files_sec = thunar
$browser = brave
$termPri = foot
$termSec = kitty
$scriptsDir = $HOME/.config/hypr/scripts

# Scripts Variables
$AirplaneMode = $scriptsDir/AirplaneMode.sh
$Media = $scriptsDir/MediaCtrl.sh
$screenshot = $scriptsDir/ScreenShot.sh
$volume = $scriptsDir/Volume.sh

# Misc
$ani-cli-cmd = ani-cli-mpv

# ---------------- System Controls ----------------

# Power
bind = , xf86poweroff, exec, systemctl suspend
bind = CTRL ALT, Delete, exec, hyprctl dispatch exit 0
bind = CTRL ALT, P, exec, $scriptsDir/RofiPower.sh
bind = , xf86mail, exec, $scriptsDir/RofiPower.sh # f12
bind = CTRL ALT, L, exec, $scriptsDir/LockScreen.sh
bind = , xf86Sleep, exec, $LockScreen #FN+F11 (sleep button)

# Hyprland
bind = $mainMod SHIFT, C, exec, hyprctl reload
bind = $mainMod SHIFT, Q, exec, hyprctl kill
bind = $mainMod, Escape, exec, hyprctl kill

# Wayland
bind = CTRL SHIFT, W, exec, $scriptsDir/Refresh.sh
bind = CTRL ALT, W, exec, $scriptsDir/Refresh_with_waybar.sh
bind = CTRL, W, exec, $scriptsDir/WaybarStyles.sh
bind = $mainMod, W, exec, pkill waypaper || true && waypaper
bind = $mainMod SHIFT, W, exec, $scriptsDir/WallpaperSelect.sh
bind = ALT, W, exec, $scriptsDir/WaybarLayout.sh

# ---------------- App Launchers ----------------

# Rofi
bindr = $mainMod, $mainMod_L, exec, pkill rofi || rofi -matching fuzzy -show drun -modi drun,filebrowser,run,window
bind = $mainMod, E, exec, $scriptsDir/RofiSearch.sh # Google search from Rofi
bind = $mainMod CTRL, S, exec, $scriptsDir/RofiBeats.sh
bind = $mainMod ALT, E, exec, $scriptsDir/RofiEmoji.sh
bind = $mainMod, H, exec, $scriptsDir/KeyHints.sh

# Apps
bind = $mainMod, Return, exec, $termPri
bind = $mainMod SHIFT, Return, exec, $termSec
bind = $mainMod, D, exec, $files_main
bind = $mainMod, T, exec, $files_sec
bind = $mainMod, B, exec, $browser
bind = , xf86calculator, exec, qalculate-qt #f3

# Ani-cli
bind = , xf86explorer, exec, $ani-cli-cmd -q 1080p --dub --rofi #f1
bind = , xf86homepage, exec, $ani-cli-cmd -q 1080p --rofi #f2
bind = , xf86tools, exec, $ani-cli-cmd -c --rofi #f4

# ---------------- Window Management ----------------

# Window States
bind = $mainMod SHIFT, F, togglefloating,
bind = $mainMod ALT, F, exec, hyprctl dispatch workspaceopt allfloat
bind = $mainMod, F, fullscreen
bind = $mainMod, Q, killactive,
bind = $mainMod, P, pin,

# Layout
bind = $mainMod CTRL, D, layoutmsg, removemaster
bind = $mainMod, X, fullscreen, 1
bind = $mainMod, F11, fullscreenstate, -1 2
bind = $mainMod, I, layoutmsg, addmaster
bind = $mainMod, J, layoutmsg, cyclenext
bind = $mainMod, K, layoutmsg, cycleprev
bind = $mainMod, M, exec, hyprctl dispatch splitratio 0.3
bind = $mainMod, P, pseudo, # dwindle
bind = $mainMod CTRL, Return, layoutmsg, swapwithmaster
bind = $mainMod SHIFT, M, exec, hyprctl dispatch splitratio -0.3
bind = $mainMod, Space, exec, $scriptsDir/ChangeLayout.sh

# Grouping
bind = $mainMod, G, togglegroup # toggle group
bind = $mainMod CTRL, tab, changegroupactive  # change focus to another window
bind = $mainMod CTRL, R, moveoutofgroup  # change focus to another window

# Resize
binde = $mainMod SHIFT, left, resizeactive,-50 0
binde = $mainMod SHIFT, right, resizeactive,50 0
binde = $mainMod SHIFT, up, resizeactive,0 -50
binde = $mainMod SHIFT, down, resizeactive,0 50

# Move/Resize with Mouse
bindm = $mainMod, mouse:272, movewindow
bindm = $mainMod, mouse:273, resizewindow

# ---------------- Workspace Management ----------------

# Special Workspace
bind = $mainMod SHIFT, U, movetoworkspace, special
bind = $mainMod, U, togglespecialworkspace,

# Switch Workspaces
bind = $mainMod, 1, workspace, 1
bind = $mainMod, 2, workspace, 2
bind = $mainMod, 3, workspace, 3
bind = $mainMod, 4, workspace, 4
bind = $mainMod, 5, workspace, 5
bind = $mainMod, 6, workspace, 6
bind = $mainMod, 7, workspace, 7
bind = $mainMod, 8, workspace, 8
bind = $mainMod, 9, workspace, 9
bind = $mainMod, 0, workspace, 10
bind = $mainMod, mouse_down, workspace, e+1
bind = $mainMod, mouse_up, workspace, e-1
bind = $mainMod, period, workspace, e+1
bind = $mainMod, comma, workspace, e-1

# Move to Workspaces
bind = $mainMod CTRL, 1, movetoworkspace, 1
bind = $mainMod CTRL, 2, movetoworkspace, 2
bind = $mainMod CTRL, 3, movetoworkspace, 3
bind = $mainMod CTRL, 4, movetoworkspace, 4
bind = $mainMod CTRL, 5, movetoworkspace, 5
bind = $mainMod CTRL, 6, movetoworkspace, 6
bind = $mainMod CTRL, 7, movetoworkspace, 7
bind = $mainMod CTRL, 8, movetoworkspace, 8
bind = $mainMod CTRL, 9, movetoworkspace, 9
bind = $mainMod CTRL, 0, movetoworkspace, 10
bind = $mainMod CTRL, bracketleft, movetoworkspace, -1
bind = $mainMod CTRL, bracketright, movetoworkspace, +1

# Move to Workspaces (Silent)
bind = $mainMod SHIFT, 1, movetoworkspacesilent, 1
bind = $mainMod SHIFT, 2, movetoworkspacesilent, 2
bind = $mainMod SHIFT, 3, movetoworkspacesilent, 3
bind = $mainMod SHIFT, 4, movetoworkspacesilent, 4
bind = $mainMod SHIFT, 5, movetoworkspacesilent, 5
bind = $mainMod SHIFT, 6, movetoworkspacesilent, 6
bind = $mainMod SHIFT, 7, movetoworkspacesilent, 7
bind = $mainMod SHIFT, 8, movetoworkspacesilent, 8
bind = $mainMod SHIFT, 9, movetoworkspacesilent, 9
bind = $mainMod SHIFT, 0, movetoworkspacesilent, 10
bind = $mainMod SHIFT, bracketleft, movetoworkspacesilent, -1
bind = $mainMod SHIFT, bracketright, movetoworkspacesilent, +1

# Razer mouse
bind = , mouse:275, workspace, e-1
bind = , mouse:276, workspace, e+1

# ---------------- Multimedia Controls ----------------

# Volume
bind = , xf86audioraisevolume, exec, $volume --inc
bind = , xf86audiolowervolume, exec, $volume --dec
bind = , xf86AudioMicMute, exec, $volume --toggle-mic
bind = , xf86audiomute, exec, $volume --toggle #FN+F1

# Brightness
bind = , XF86MonBrightnessUp, exec, ~/.config/hypr/scripts/Brightness.sh --inc
bind = , XF86MonBrightnessDown, exec, ~/.config/hypr/scripts/Brightness.sh --dec
bind = , SCROLL_LOCK, exec, ~/.config/hypr/scripts/Brightness.sh --dec
bind = , PAUSE, exec, ~/.config/hypr/scripts/Brightness.sh --inc
bind = CTRL , xf86audioraisevolume, exec, ~/.config/hypr/scripts/Brightness.sh --inc
bind = CTRL , xf86audiolowervolume, exec, ~/.config/hypr/scripts/Brightness.sh --dec

# Media
bind = , xf86AudioPlayPause, exec, $Media --pause
bind = , xf86AudioPause, exec, $Media --pause
bind = , xf86AudioPlay, exec, $Media --pause
bind = , xf86AudioNext, exec, $Media --nxt
bind = , xf86AudioPrev, exec, $Media --prv
bind = , xf86audiostop, exec, $Media --stop

# Hyprsunset controls
bind = ALT, xf86audioraisevolume, exec, hyprctl hyprsunset temperature +400
bind = ALT, xf86audiolowervolume, exec, hyprctl hyprsunset temperature -400
bind = ALT, xf86audiomute, exec, hyprctl hyprsunset temperature $([ $(hyprctl hyprsunset temperature) = 6500 ] && echo 3500 || echo 6500)

# ---------------- Screenshot ----------------

bind = , Print, exec, $screenshot --now
bind = ALT, Print, exec, $screenshot --hush
bind = $mainMod CTRL, Print, exec, $screenshot --in5
bind = $mainMod ALT, Print, exec, $screenshot --in10
bind = CTRL, Print, exec, $screenshot --win
bind = SHIFT, Print, exec, $screenshot --area
bind = $mainMod SHIFT, Print, exec, $screenshot --area
# bind = $mainMod SHIFT, S, exec, grim -g "$(slurp && sleep 0.1)" - | satty -f - #swappy -f -
# bind = $mainMod SHIFT, S, exec, grim -g "$(slurp && sleep 0.5)" -t ppm - | satty -f -  --output-filename ~/Pictures/Screenshots/satty-$(date '+%Y-%m-%d_%H%M%S').png
bind = $mainMod SHIFT, S, exec, grim -g "$(slurp)" -t ppm - | satty -f -  --output-filename ~/Pictures/Screenshots/satty-$(date '+%Y-%m-%d_%H%M%S').png

# ---------------- Misc ----------------

# Dropdown terminal
$drop_down_cmd="foot -e zellij attach --create scratchpad"
bind = $mainMod, S,exec,$scriptsDir/Dropterminal_adv.sh $drop_down_cmd # Dropdown terminal
bind = , Insert,exec,$scriptsDir/Dropterminal_adv.sh $drop_down_cmd # Dropdown terminal
# bind = $mainMod SHIFT, K,exec,pypr toggle kew_player

# Overview
# bind = $mainMod, tab, exec, ags -t 'overview'
# bind = $mainMod, tab, exec, pkill -f ~/.config/scripts/overview.py || ~/.venv/bin/python ~/.config/scripts/overview.py
bind = $mainMod, Tab, global, quickshell:overviewToggle

# Clip Manager
bind = $mainMod, V, exec, $scriptsDir/ClipManager.sh

# System
bind = , xf86Rfkill, exec, $AirplaneMode #Airplane mode FN+F12

# Window Effects
bind = $mainMod SHIFT, B, exec, $scriptsDir/ChangeBlur.sh # Toggle blur settings
bind = $mainMod SHIFT, G, exec, $scriptsDir/GameMode.sh
bind = $mainMod, L, exec, $scriptsDir/hyprshade.sh

# Window Opacity
bind = $mainMod ALT, O, exec, hyprctl setprop active opaque toggle # disable opacity on active window

# Cursor Zoom
bind = $mainMod CTRL, mouse_down, exec, hyprctl keyword cursor:zoom_factor $(awk "BEGIN {print $(hyprctl getoption cursor:zoom_factor | grep 'float:' | awk '{print $2}') + 0.7}") # Zoom out
bind = $mainMod CTRL, mouse_up, exec, hyprctl keyword cursor:zoom_factor $(awk "BEGIN {print $(hyprctl getoption cursor:zoom_factor | grep 'float:' | awk '{print $2}') - 0.7}") # Zoom in

# HyprTasking
# bind = $mainMod, I, hyprexpo:expo, toggle
# bind = $mainMod, I, hyprtasking:toggle, cursor
# bind = $mainMod, left, hyprtasking:move, left
# bind = $mainMod, down, hyprtasking:move, down
# bind = $mainMod, up, hyprtasking:move, up
# bind = $mainMod, right, hyprtasking:move, right

# YTDL-MPV
bind = $mainMod, Y, exec, ytdl-mpv

# MPV from clipboard
bind = $mainMod ALT, M, exec, notify-send -t 3000 -i ~/.config/swaync/assets/play-circle.png "MPV" "Loading video..." && mpv "$(wl-paste)"

# Swaync
bind = $mainMod, N, exec, swaync-client -t -sw

# Window Cycle
bind = ALT, tab, cyclenext
bind = ALT, tab, bringactivetotop

# Search Keybinds
bind = $mainMod, K, exec, $scriptsDir/Key-bind.sh # search keybinds via rofi

# VM Passthrough
bind = $mainMod ALT, P, submap, passthru
submap = passthru
#to unbind
bind = $mainMod Escape, P, submap, reset
submap = reset

# Mouse scroll tilt back and forward
bind = , mouse_left, exec, wtype -M alt -k left -m alt
bind = , mouse_right, exec, wtype -M alt -k right -m alt

# OCR (Tesseract)
bind = $mainMod, O, exec, slurp | grim -g - - | tesseract stdin stdout -l eng | wl-copy
bind = $mainMod SHIFT, O, exec, grim - | tesseract stdin stdout -l eng | wl-copy